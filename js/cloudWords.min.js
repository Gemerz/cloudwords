/** 
 * -------------------------------------------------------------
 * Copyright (c) 2013 Gemerz, All rights reserved. 
 *  
 * @version: 1.0.1 
 * @author: Gemer zhang <Gemercheung@gmail.com> 
 * @description: A canvas word particles just like cloudWords 
 * ------------------------------------------------------------- 
 */ 

(function(a,b){"use strict";var c,d,e={};return a.requestAnimationFrame?(e.is=function(a,b){return Object.prototype.toString.call(a).slice(8,-1)===b},e.copy=function(a,b){for(var c in b)if(b.hasOwnProperty(c)){var d=b[c];a[c]=this.is(d,"Object")?this.copy({},d):this.is(d,"Array")?this.copy([],d):d}return a},e.merge=function(b){var c={id:"cloudWords",word:["Gemer","zhang"],color:["#e1f3f4","#eaf1f1"],width:a.innerWidth,height:"200",position:"center",fontsize:"100",auto:!1,index:0,second:4},d=e.copy(c,b);return d},e.capable=function(a){return a.getContext&&a.getContext("2d")},e.randomBetween=function(a,b){return~~(Math.random()*(a-b+1)+b)},e.distanceTo=function(a,b){var c=Math.abs(a.x-b.x),d=Math.abs(a.y-b.y);return Math.sqrt(c*c+d*d)},e.scrollX=function(){return a.pageXOffset||a.document.documentElement.scrollLeft},e.scrollY=function(){return a.pageXOffset||a.document.documentElement.scrollTop},e.mouse={x:-99999,y:-99999},c=function(a){var b=e.merge(a);this.config=b;var c={particles:[],text:[],nextText:[],shape:{}};this.cache=c,this.set()},c.prototype.set=function(){var c=this,f=b.getElementById(c.config.id),g=b.createElement("canvas");if(this.canvas=g,g.width=c.config.width,g.height=c.config.height,f.appendChild(g),e.capable(g)){d=g.getContext("2d"),this.createParticles();var h=function(){c.loop(),a.requestAnimationFrame(h)};h();var i=c.config.auto?!0:!1;i&&c.autoplay(),this.config.mouse,"ontouchmove"in a?g.addEventListener("touchmove",this._onMove,!1):(g.addEventListener("mousemove",c._onMouseMove,!1),g.addEventListener("click",function(){c._clickNext("+=1")},!1))}else console.log("your brower is not support canvas!")},c.prototype.createParticles=function(){var a=this;a.createText()},c.prototype.autoplay=function(){this.run("+=1")},c.prototype._clickNext=function(a){var b=this,c=b.config.index,d=this.config.word.length,e="string"==typeof a?c+parseInt(a.replace("=",""),10):a;e>=d&&(b.config.index=e=0),b.cache.nextText=[],b.createText(e),b.config.index=e},c.prototype.run=function(a){var b=this,c=this.config.index,d="string"==typeof a?c+parseInt(a.replace("=",""),10):a,e=this.config.word.length;setInterval(function(){b.cache.nextText=[],b.createText(d),d++,d>=e&&(d=c=0)},1e3*b.config.second)},c.prototype.createText=function(a){this.clear();var b=this,c=b.canvas,f=b.config.word,g=a?a:0;d.font=this.config.fontsize+"px Arial, sans-serif",d.textAlign=this.config.position;var h=f[g].toUpperCase().split("").join(String.fromCharCode(8202));d.fillText(h,.5*c.width,c.height-50);for(var i=d.getImageData(0,0,c.width,c.height),j=0;j<i.width;j+=4)for(var k=0;k<i.width;k+=4){var l=i.data[4*k*i.width+4*j-1];255===l&&b.cache.nextText.push({x:j,y:k,orbit:e.randomBetween(1,3),angle:0})}var m=b.cache.nextText.length;this.createTextParticles(m)},c.prototype.createTextParticles=function(a){for(var b=this,c=b.canvas,d=0,f=a;f>d;d++){var g=e.randomBetween(0,12),h=g>0||12>g?!1:!0,i=this.config.color,j=i[~~(Math.random()*i.length)];b.cache.text.push({x:.5*c.width,y:c.height-70,hasBorn:h,ease:.04+.06*Math.random(),bornSpeed:.07+.07*Math.random(),alpha:0,maxAlpha:.7+.4*Math.random(),radius:g,maxRadius:12,color:j,interactive:!1})}},c.prototype.updateTransition=function(){var a=this,b=a.cache.text,c=a.cache.nextText;if([].forEach.call(c,function(a,c){b[c].interactive?(b[c].x+=.08*(e.mouse.x+30*Math.sin(a.angle)-b[c].x),b[c].y+=.08*(e.mouse.y+30*Math.cos(a.angle)-b[c].y)):(b[c].x+=.08*(a.x+Math.cos(a.angle+c)*a.orbit-b[c].x),b[c].y+=.08*(a.y+Math.sin(a.angle+c)*a.orbit-b[c].y)),a.angle+=.08}),c.length<b.length)for(var d=[].slice.call(b,c.length,b.length),f=0;f<d.length;f++)b.splice(f,1)},c.prototype.update=function(){var a=this;a.updateTransition(),[].forEach.call(a.cache.text,function(a){a.alpha+=.05*(a.maxAlpha-a.alpha),a.hasBorn&&(a.radius+=(0-a.radius)*a.bornSpeed,0===Math.round(a.radius)&&(a.hasBorn=!1)),a.hasBorn||(a.radius+=(a.maxRadius-a.radius)*a.bornSpeed,Math.round(a.radius)===a.maxRadius&&(a.hasBorn=!0)),a.interactive=e.distanceTo(e.mouse,a)<=a.radius+30?!0:!1})},c.prototype.render=function(){var a=this;[].forEach.call(a.cache.text,function(a){d.save(),d.globalAlpha=a.alpha,d.fillStyle=a.color,d.beginPath(),d.arc(a.x,a.y,a.radius,0,2*Math.PI),d.fill(),d.restore()})},c.prototype.clear=function(){d.clearRect(0,0,this.canvas.width,this.canvas.height)},c.prototype.loop=function(){var a=this;a.clear(),a.update(),a.render()},c.prototype._onMouseMove=function(a){a.preventDefault(),e.mouse.x=a.pageX-(e.scrollX()+this.getBoundingClientRect().left),e.mouse.y=a.pageY-(e.scrollY()+this.getBoundingClientRect().top)},a.requestAnimFrame=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)}}(),this.cloudWords=c,void 0):alert(":( Your device doesn't have native support of requestAnimationFrame Api.")}).call(this,window,document);